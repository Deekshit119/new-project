<?xml version="1.0" encoding="UTF-8"?><record_update table="sys_script_include">
    <sys_script_include action="INSERT_OR_UPDATE">
        <access>package_private</access>
        <active>true</active>
        <api_name>x_sksw_uk_itsm.UK_SCCMHelper</api_name>
        <caller_access/>
        <client_callable>false</client_callable>
        <description/>
        <name>UK_SCCMHelper</name>
        <script><![CDATA[// SCCM Helper

/**
 * Helper functions converted from SoftwareMunger.java and CMDBHelper.java
 *
 * Aleck Lin aleck.lin@service-now.com
 */

var UK_SCCMHelper = Class.create();

UK_SCCMHelper.findComputer = function(id) {
	// Find the SCCM ID in the correlation_id field
	var gr = new GlideRecord("cmdb_ci_computer");
	gr.addQuery("correlation_id", id);
	gr.query();
	if (gr.next())
		return gr.sys_id + '';
	
	// Find the SCCM ID in the source table
	var gr = new GlideRecord("sys_object_source");
	gr.addQuery("name", "SCCM");
	gr.addQuery("id", id);
	gr.query();
	if (gr.next()) {
		var grr = new GlideRecord(gr.target_table + '');
		if (grr.get(gr.target_sys_id + ''))
			return grr.sys_id + '';
	}
	
	return null;
};


UK_SCCMHelper.fixCompany = function(company) {
	if (company.contains("(R)"))
		company = company.replace("(R)", "");
	
	if (company.contains("®"))
		company = company.replace("®", "");
	
	if (company.contains("™"))
		company = company.replace("™", "");
	
	if (company.contains("(TM)"))
		company = company.replace("(TM)", "");
	
	if (company.endsWith(" Corporation") || company.endsWith(" Corp.") || company.endsWith(" Corp"))
		company = company.substring(0, company.lastIndexOf(" "));
	
	if (company.endsWith("."))
		company = company.substring(0, company.length - 1);
	
	if (company.endsWith(" Inc") || company.endsWith(" Ltd"))
		company = company.substring(0, company.lastIndexOf(" "));
	
	if (company.endsWith(","))
		company = company.substring(0, company.length - 1);
	
	if (company.endsWith(" Incorporated"))
		company = company.substring(0, company.lastIndexOf(" "));
	
	// strip off genuine, its just intel
	if (company.equals("GenuineIntel"))
		company = "Intel";
	
	// strip off computer if its dell
	if (company.toLowerCase().equals("dell computer"))
		company = "Dell";
	
	company = company.trim();
	
	return company;
};


UK_SCCMHelper.deleteTrailing = function (str,trailing) {
	if (JSUtil.nil(str) || JSUtil.nil(trailing))
		return str;
	
	if (str.length <= trailing.length)
		return str;
	
	//str does not end with trailing
	if (str.indexOf(trailing, str.length - trailing.length) == -1)
		return str;
	
	return str.substring(0, str.length - trailing.length);
};


UK_SCCMHelper.mungeName = function(name, version) {
	var PAT_VERSION_IN_NAME = /^(.*) v?(\d+(?:\.\d+)*)$/;  //Software v1.02
	
	name = name.trim();
	
	if (JSUtil.nil(version) && name.match(PAT_VERSION_IN_NAME)) {
		var format =  "$1";
		name = name.replace(PAT_VERSION_IN_NAME, format);
	} else {
		name = this.deleteTrailing(name, version.trim()).trim();
		name = this.deleteTrailing(name, ",").trim();
	}
	
	name = this.deleteTrailing(name, "(remove only)").trim();
	name = this.deleteTrailing(name, "(english)").trim();
	name = this.deleteTrailing(name, "[english]").trim();
	
	return name;
};


UK_SCCMHelper.mungeVendor = function(manu) {
	if (JSUtil.nil(manu))
		return "";
	
	if (manu.startsWith("Adobe "))
		return "Adobe Systems";
	
	if (manu.startsWith("Microsoft "))
		return "Microsoft";
	
	return this.fixCompany(manu);
};


UK_SCCMHelper.mungeVersion = function(version) {
	if (JSUtil.nil(version))
		return null;
	
	var REGEX_LEADING_ZEROES = /^0+(\d+)/;       //pattern 0232 -> 232
	
	var PAT_SURPLUS_ZEROES = /^(.*?(?:\.0)?)(?:\.0)*$/;      //pattern 123.0.0.0 -> 123.0
	
	var parts = version.trim().split(".");
	
	for( var i = 0; i < parts.length; i++) {
		parts[i] = parts[i].replace(REGEX_LEADING_ZEROES,"$1");
	}
	
	version = parts.join(".");
	version = version.replace(PAT_SURPLUS_ZEROES,"$1");
	
	return version;
};


UK_SCCMHelper.asGlideDate = function(date) {
	var pattern = /(\d{4})(\d{2})(\d{2})/; // yyyyMMdd
	if (JSUtil.nil(date) || !date.match(pattern))
		return;

	var format = "$1-$2-$3 00:00:00"; // yyyy-MM-dd 00:00:00
	var formattedDate = date.replace(pattern, format);
	var glideDate = new GlideDateTime();
	glideDate.setValue(formattedDate);

	return glideDate;
};
	
	
UK_SCCMHelper.prototype = {

	initialize: function() {
	},

	type: "UK_SCCMHelper"
};]]></script>
        <sys_class_name>sys_script_include</sys_class_name>
        <sys_created_by>erdinc.pinar@flyform.com</sys_created_by>
        <sys_created_on>2019-11-19 17:12:44</sys_created_on>
        <sys_customer_update>false</sys_customer_update>
        <sys_id>d671fd101b5108104252c8017e4bcbe0</sys_id>
        <sys_mod_count>0</sys_mod_count>
        <sys_name>UK_SCCMHelper</sys_name>
        <sys_package display_value="UK ITSM" source="x_sksw_uk_itsm">7889315b1bd04410eb7365386e4bcbbb</sys_package>
        <sys_policy>read</sys_policy>
        <sys_replace_on_upgrade>false</sys_replace_on_upgrade>
        <sys_scope display_value="UK ITSM">7889315b1bd04410eb7365386e4bcbbb</sys_scope>
        <sys_update_name>sys_script_include_d671fd101b5108104252c8017e4bcbe0</sys_update_name>
        <sys_updated_by>erdinc.pinar@flyform.com</sys_updated_by>
        <sys_updated_on>2019-11-19 17:12:44</sys_updated_on>
    </sys_script_include>
</record_update>
